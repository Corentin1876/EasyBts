{% extends 'base.html.twig' %}

{% block title %}Dossier d'inscription {{ specialisation.nom }} - Inscription BTS{% endblock %}

{% block body %}
<!-- Fil d'ariane -->
<nav class="fr-breadcrumb" aria-label="vous êtes ici :">
    <button class="fr-breadcrumb__button" aria-expanded="false" aria-controls="breadcrumb-form">Voir le fil d'Ariane</button>
    <div class="fr-collapse" id="breadcrumb-form">
        <ol class="fr-breadcrumb__list">
            <li><a class="fr-breadcrumb__link" href="{{ path('app_home') }}">Accueil</a></li>
            <li><a class="fr-breadcrumb__link" href="{{ path('app_bts_liste') }}">Inscription BTS</a></li>
            <li><a class="fr-breadcrumb__link" aria-current="page">{{ specialisation.nom }}</a></li>
        </ol>
    </div>
</nav>

<!-- En-tête -->
<section class="fr-container fr-py-6v">
    <div class="fr-grid-row">
        <div class="fr-col-12">
            <h1 class="fr-h1">Dossier d'inscription {{ specialisation.nom }}</h1>
            <p class="fr-text--lead fr-mb-3v">
                Remplissez le formulaire ci-dessous pour finaliser votre inscription. Votre progression est sauvegardée automatiquement.
            </p>
            <div class="fr-alert fr-alert--info fr-mb-4v">
                <p class="fr-mb-1v"><strong>Spécialisation sélectionnée :</strong> {{ specialisation.nom }}</p>
                <p class="fr-text--sm">Vous pouvez revenir plus tard : votre progression est enregistrée automatiquement même si vous vous déconnectez.</p>
            </div>
        </div>
    </div>
</section>

<!-- Indicateur de progression -->
<section class="fr-container fr-mb-4v">
    <div class="fr-stepper">
        <h2 class="fr-stepper__title">
            <span class="fr-stepper__state">Étape <span id="current-step">1</span> sur 6</span>
        </h2>
        <div class="fr-stepper__steps" data-fr-current-step="1" data-fr-steps="6"></div>
        <p class="fr-stepper__details">
            <span class="fr-text--bold" id="step-title">Identité de l'étudiant</span>
        </p>
    </div>
</section>

<!-- Formulaire d'inscription -->
<section class="fr-container fr-pb-6v">
    <form class="fr-form" id="inscription-form" method="post" action="{{ path('app_bts_inscription_submit', {'id': specialisation.id}) }}" enctype="multipart/form-data">

        <!-- Section 1: Identité de l'étudiant -->
        <div class="form-step" id="step-1">
            <div class="fr-card">
                <div class="fr-card__body">
                    <h2 class="fr-h2 fr-mb-3v">Identité de l'étudiant</h2>

                    <div class="fr-grid-row fr-grid-row--gutters">
                        <div class="fr-col-12 fr-col-md-6">
                            <div class="fr-input-group">
                                <label class="fr-label" for="nom">Nom (en majuscule) <span class="fr-text--red">*</span></label>
                                <input class="fr-input" type="text" id="nom" name="nom" value="{{ app.user.nom|upper }}" required style="text-transform: uppercase;">
                            </div>
                        </div>
                        <div class="fr-col-12 fr-col-md-6">
                            <div class="fr-input-group">
                                <label class="fr-label" for="prenom">Prénom <span class="fr-text--red">*</span></label>
                                <input class="fr-input" type="text" id="prenom" name="prenom" value="{{ app.user.prenom }}" required>
                            </div>
                        </div>
                    </div>

                    <div class="fr-grid-row fr-grid-row--gutters">
                        <div class="fr-col-12 fr-col-md-6">
                            <div class="fr-select-group">
                                <label class="fr-label" for="sexe">Sexe <span class="fr-text--red">*</span></label>
                                <select class="fr-select" id="sexe" name="sexe" required>
                                    <option value="" selected disabled>Sélectionner</option>
                                    <option value="M">Masculin</option>
                                    <option value="F">Féminin</option>
                                </select>
                            </div>
                        </div>
                        <div class="fr-col-12 fr-col-md-6">
                            <div class="fr-input-group">
                                <label class="fr-label" for="date_naissance">Date de naissance <span class="fr-text--red">*</span></label>
                                <input class="fr-input" type="date" id="date_naissance" name="date_naissance" value="{{ app.user.dateNaissance ? app.user.dateNaissance|date('Y-m-d') : '' }}" required>
                            </div>
                        </div>
                    </div>

                    <div class="fr-grid-row fr-grid-row--gutters">
                        <div class="fr-col-12 fr-col-md-6">
                            <div class="fr-input-group">
                                <label class="fr-label" for="nationalite">Nationalité <span class="fr-text--red">*</span></label>
                                <input class="fr-input" type="text" id="nationalite" name="nationalite" required>
                            </div>
                        </div>
                        <div class="fr-col-12 fr-col-md-6">
                            <div class="fr-input-group">
                                <label class="fr-label" for="numero_secu">Numéro de sécurité sociale</label>
                                <input class="fr-input" type="text" id="numero_secu" name="numero_secu" maxlength="15">
                            </div>
                        </div>
                    </div>

                    <div class="fr-grid-row fr-grid-row--gutters">
                        <div class="fr-col-12 fr-col-md-6">
                            <div class="fr-input-group">
                                <label class="fr-label" for="dep_naissance">Département de naissance <span class="fr-text--red">*</span></label>
                                <input class="fr-input" type="text" id="dep_naissance" name="dep_naissance" required>
                            </div>
                        </div>
                        <div class="fr-col-12 fr-col-md-6">
                            <div class="fr-input-group">
                                <label class="fr-label" for="commune_naissance">Commune de naissance <span class="fr-text--red">*</span></label>
                                <input class="fr-input" type="text" id="commune_naissance" name="commune_naissance" required>
                            </div>
                        </div>
                    </div>

                    <div class="fr-grid-row fr-grid-row--gutters">
                        <div class="fr-col-12 fr-col-md-6">
                            <div class="fr-input-group">
                                <label class="fr-label" for="tel_eleve">Téléphone mobile de l'élève <span class="fr-text--red">*</span></label>
                                <input class="fr-input" type="tel" id="tel_eleve" name="tel_eleve" value="{{ app.user.telephone }}" required>
                            </div>
                        </div>
                        <div class="fr-col-12 fr-col-md-6">
                            <div class="fr-input-group">
                                <label class="fr-label" for="email_eleve">Courriel de l'élève <span class="fr-text--red">*</span></label>
                                <input class="fr-input" type="email" id="email_eleve" name="email_eleve" value="{{ app.user.email }}" required readonly>
                            </div>
                        </div>
                    </div>

                    <div class="fr-input-group">
                        <label class="fr-label" for="date_entree">Date d'entrée <span class="fr-text--red">*</span></label>
                        <input class="fr-input" type="date" id="date_entree" name="date_entree" required>
                    </div>
                </div>
            </div>
        </div>

        <!-- Section 2: Scolarité de l'année d'inscription -->
        <div class="form-step" id="step-2" style="display: none;">
            <div class="fr-card">
                <div class="fr-card__body">
                    <h2 class="fr-h2 fr-mb-3v">Scolarité de l'année d'inscription</h2>

                    <div class="fr-grid-row fr-grid-row--gutters">
                        <div class="fr-col-12 fr-col-md-6">
                            <div class="fr-select-group">
                                <label class="fr-label" for="redoublement">Redoublement BTS <span class="fr-text--red">*</span></label>
                                <select class="fr-select" id="redoublement" name="redoublement" required>
                                    <option value="" selected disabled>Sélectionner</option>
                                    <option value="0">Non</option>
                                    <option value="1">Oui</option>
                                </select>
                            </div>
                        </div>
                        <div class="fr-col-12 fr-col-md-6">
                            <div class="fr-select-group">
                                <label class="fr-label" for="niveau_classe">Classe <span class="fr-text--red">*</span></label>
                                <select class="fr-select" id="niveau_classe" name="niveau_classe" required>
                                    <option value="" selected disabled>Sélectionner</option>
                                    <option value="BTS 1ère année">BTS 1ère année</option>
                                    <option value="BTS 2ème année">BTS 2ème année</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="fr-select-group">
                        <label class="fr-label" for="regime_scolaire">Régime scolaire <span class="fr-text--red">*</span></label>
                        <select class="fr-select" id="regime_scolaire" name="regime_scolaire" required>
                            <option value="" selected disabled>Sélectionner</option>
                            <option value="Externe">Externe</option>
                            <option value="Demi-pensionnaire à l'unité">Demi-pensionnaire à l'unité</option>
                            <option value="Demi-pensionnaire au forfait 4 jours">Demi-pensionnaire au forfait 4 jours</option>
                            <option value="Demi-pensionnaire au forfait 5 jours">Demi-pensionnaire au forfait 5 jours</option>
                        </select>
                    </div>

                    <div class="fr-grid-row fr-grid-row--gutters">
                        <div class="fr-col-12 fr-col-md-4">
                            <div class="fr-select-group">
                                <label class="fr-label" for="transport">Transport <span class="fr-text--red">*</span></label>
                                <select class="fr-select" id="transport" name="transport" required>
                                    <option value="" selected disabled>Sélectionner</option>
                                    <option value="0">Non</option>
                                    <option value="1">Oui</option>
                                </select>
                            </div>
                        </div>
                        <div class="fr-col-12 fr-col-md-4">
                            <div class="fr-select-group">
                                <label class="fr-label" for="type_transport">Type de transport</label>
                                <select class="fr-select" id="type_transport" name="type_transport">
                                    <option value="">Aucun</option>
                                    <option value="Train">Train</option>
                                    <option value="Bus">Bus</option>
                                    <option value="Autres">Autres</option>
                                </select>
                            </div>
                        </div>
                        <div class="fr-col-12 fr-col-md-4">
                            <div class="fr-input-group">
                                <label class="fr-label" for="immatriculation">Immatriculation véhicule</label>
                                <input class="fr-input" type="text" id="immatriculation" name="immatriculation" placeholder="Si parking">
                            </div>
                        </div>
                    </div>

                    <div class="fr-grid-row fr-grid-row--gutters">
                        <div class="fr-col-12 fr-col-md-6">
                            <div class="fr-input-group">
                                <label class="fr-label" for="lv1">Langue LV1 <span class="fr-text--red">*</span></label>
                                <input class="fr-input" type="text" id="lv1" name="lv1" placeholder="Ex: Anglais" required>
                            </div>
                        </div>
                        <div class="fr-col-12 fr-col-md-6">
                            <div class="fr-input-group">
                                <label class="fr-label" for="lv2">Langue LV2 (facultatif)</label>
                                <input class="fr-input" type="text" id="lv2" name="lv2" placeholder="Ex: Espagnol">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Section 3: Scolarité des 2 années antérieures -->
        <div class="form-step" id="step-3" style="display: none;">
            <div class="fr-card">
                <div class="fr-card__body">
                    <h2 class="fr-h2 fr-mb-3v">Scolarité des 2 années antérieures</h2>

                    <h3 class="fr-h3 fr-mb-2v">Année N-1</h3>
                    <div class="fr-grid-row fr-grid-row--gutters">
                        <div class="fr-col-12 fr-col-md-6">
                            <div class="fr-input-group">
                                <label class="fr-label" for="annee_n1">Année scolaire <span class="fr-text--red">*</span></label>
                                <input class="fr-input" type="text" id="annee_n1" name="annee_n1" placeholder="Ex: 2023-2024" required>
                            </div>
                        </div>
                        <div class="fr-col-12 fr-col-md-6">
                            <div class="fr-input-group">
                                <label class="fr-label" for="classe_n1">Classe <span class="fr-text--red">*</span></label>
                                <input class="fr-input" type="text" id="classe_n1" name="classe_n1" placeholder="Ex: Terminale" required>
                            </div>
                        </div>
                    </div>
                    <div class="fr-grid-row fr-grid-row--gutters">
                        <div class="fr-col-12 fr-col-md-6">
                            <div class="fr-input-group">
                                <label class="fr-label" for="lv1_n1">LV1 <span class="fr-text--red">*</span></label>
                                <input class="fr-input" type="text" id="lv1_n1" name="lv1_n1" required>
                            </div>
                        </div>
                        <div class="fr-col-12 fr-col-md-6">
                            <div class="fr-input-group">
                                <label class="fr-label" for="lv2_n1">LV2</label>
                                <input class="fr-input" type="text" id="lv2_n1" name="lv2_n1">
                            </div>
                        </div>
                    </div>
                    <div class="fr-input-group">
                        <label class="fr-label" for="etablissement_n1">Établissement <span class="fr-text--red">*</span></label>
                        <input class="fr-input" type="text" id="etablissement_n1" name="etablissement_n1" required>
                    </div>

                    <hr class="fr-hr fr-my-4v">

                    <h3 class="fr-h3 fr-mb-2v">Année N-2</h3>
                    <div class="fr-grid-row fr-grid-row--gutters">
                        <div class="fr-col-12 fr-col-md-6">
                            <div class="fr-input-group">
                                <label class="fr-label" for="annee_n2">Année scolaire <span class="fr-text--red">*</span></label>
                                <input class="fr-input" type="text" id="annee_n2" name="annee_n2" placeholder="Ex: 2022-2023" required>
                            </div>
                        </div>
                        <div class="fr-col-12 fr-col-md-6">
                            <div class="fr-input-group">
                                <label class="fr-label" for="classe_n2">Classe <span class="fr-text--red">*</span></label>
                                <input class="fr-input" type="text" id="classe_n2" name="classe_n2" placeholder="Ex: Première" required>
                            </div>
                        </div>
                    </div>
                    <div class="fr-grid-row fr-grid-row--gutters">
                        <div class="fr-col-12 fr-col-md-6">
                            <div class="fr-input-group">
                                <label class="fr-label" for="lv1_n2">LV1 <span class="fr-text--red">*</span></label>
                                <input class="fr-input" type="text" id="lv1_n2" name="lv1_n2" required>
                            </div>
                        </div>
                        <div class="fr-col-12 fr-col-md-6">
                            <div class="fr-input-group">
                                <label class="fr-label" for="lv2_n2">LV2</label>
                                <input class="fr-input" type="text" id="lv2_n2" name="lv2_n2">
                            </div>
                        </div>
                    </div>
                    <div class="fr-input-group">
                        <label class="fr-label" for="etablissement_n2">Établissement <span class="fr-text--red">*</span></label>
                        <input class="fr-input" type="text" id="etablissement_n2" name="etablissement_n2" required>
                    </div>

                    <hr class="fr-hr fr-my-4v">

                    <div class="fr-input-group">
                        <label class="fr-label" for="dernier_diplome">Dernier diplôme obtenu <span class="fr-text--red">*</span></label>
                        <input class="fr-input" type="text" id="dernier_diplome" name="dernier_diplome" placeholder="Ex: Baccalauréat Général" required>
                    </div>
                </div>
            </div>
        </div>

        <!-- Section 4: Responsables légaux -->
        <div class="form-step" id="step-4" style="display: none;">
            <div class="fr-card">
                <div class="fr-card__body">
                    <h2 class="fr-h2 fr-mb-3v">Identité des responsables légaux</h2>

                    <h3 class="fr-h3 fr-mb-2v">Responsable légal 1</h3>
                    <div class="fr-select-group">
                        <label class="fr-label" for="lien_resp1">Lien avec l'élève <span class="fr-text--red">*</span></label>
                        <select class="fr-select" id="lien_resp1" name="lien_resp1" required>
                            <option value="" selected disabled>Sélectionner</option>
                            <option value="Père">Père</option>
                            <option value="Mère">Mère</option>
                            <option value="Autre">Autre</option>
                        </select>
                    </div>

                    <div class="fr-grid-row fr-grid-row--gutters">
                        <div class="fr-col-12 fr-col-md-6">
                            <div class="fr-input-group">
                                <label class="fr-label" for="nom_resp1">Nom <span class="fr-text--red">*</span></label>
                                <input class="fr-input" type="text" id="nom_resp1" name="nom_resp1" required>
                            </div>
                        </div>
                        <div class="fr-col-12 fr-col-md-6">
                            <div class="fr-input-group">
                                <label class="fr-label" for="prenom_resp1">Prénom <span class="fr-text--red">*</span></label>
                                <input class="fr-input" type="text" id="prenom_resp1" name="prenom_resp1" required>
                            </div>
                        </div>
                    </div>

                    <div class="fr-input-group">
                        <label class="fr-label" for="adresse_resp1">Adresse <span class="fr-text--red">*</span></label>
                        <input class="fr-input" type="text" id="adresse_resp1" name="adresse_resp1" required>
                    </div>

                    <div class="fr-input-group">
                        <label class="fr-label" for="commune_resp1">Commune <span class="fr-text--red">*</span></label>
                        <input class="fr-input" type="text" id="commune_resp1" name="commune_resp1" required>
                    </div>

                    <div class="fr-grid-row fr-grid-row--gutters">
                        <div class="fr-col-12 fr-col-md-6">
                            <div class="fr-input-group">
                                <label class="fr-label" for="tel_mobile_resp1">Téléphone mobile <span class="fr-text--red">*</span></label>
                                <input class="fr-input" type="tel" id="tel_mobile_resp1" name="tel_mobile_resp1" required>
                            </div>
                        </div>
                        <div class="fr-col-12 fr-col-md-6">
                            <div class="fr-input-group">
                                <label class="fr-label" for="email_resp1">Courriel <span class="fr-text--red">*</span></label>
                                <input class="fr-input" type="email" id="email_resp1" name="email_resp1" required>
                            </div>
                        </div>
                    </div>

                    <div class="fr-input-group">
                        <label class="fr-label" for="profession_resp1">Profession <span class="fr-text--red">*</span></label>
                        <input class="fr-input" type="text" id="profession_resp1" name="profession_resp1" required>
                    </div>

                    <div class="fr-grid-row fr-grid-row--gutters">
                        <div class="fr-col-12 fr-col-md-6">
                            <div class="fr-select-group">
                                <label class="fr-label" for="sms_resp1">Acceptation SMS <span class="fr-text--red">*</span></label>
                                <select class="fr-select" id="sms_resp1" name="sms_resp1" required>
                                    <option value="" selected disabled>Sélectionner</option>
                                    <option value="1">Oui</option>
                                    <option value="0">Non</option>
                                </select>
                            </div>
                        </div>
                        <div class="fr-col-12 fr-col-md-6">
                            <div class="fr-select-group">
                                <label class="fr-label" for="comm_asso_resp1">Autorisation communication associations parents <span class="fr-text--red">*</span></label>
                                <select class="fr-select" id="comm_asso_resp1" name="comm_asso_resp1" required>
                                    <option value="" selected disabled>Sélectionner</option>
                                    <option value="1">Oui</option>
                                    <option value="0">Non</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Section 5: Signature et validation -->
        <!-- Étape 5 : Documents justificatifs -->
        <div class="form-step" id="step-5" style="display: none;">
            <div class="fr-card">
                <div class="fr-card__body">
                    <h2 class="fr-h2 fr-mb-3v">Documents justificatifs</h2>
                    
                    <p class="fr-text--lead fr-mb-4v">
                        Veuillez télécharger les documents suivants pour compléter votre dossier d'inscription.
                    </p>

                    <!-- Carte d'identité recto -->
                    <div class="fr-upload-group fr-mb-3v" id="upload-carte-identite-recto-group">
                        <label class="fr-label" for="carte_identite_recto">
                            Carte d'identité (recto) <span class="fr-text--red">*</span>
                            <span class="fr-hint-text">Format accepté : JPG, PNG, PDF - Taille max : 5Mo</span>
                        </label>
                        <div class="uploaded-file-info" style="display:none; margin-bottom: 0.5rem;">
                            <span class="fr-icon-check-circle-fill fr-icon--sm" style="color: green;" aria-hidden="true"></span>
                            <a href="#" class="file-name file-preview-link" style="text-decoration: underline; margin: 0 0.5rem;"></a>
                            <button type="button" class="fr-btn fr-btn--tertiary-no-outline fr-btn--sm change-file-btn">Changer</button>
                        </div>
                        <input class="fr-upload" 
                               type="file" 
                               id="carte_identite_recto" 
                               name="carte_identite_recto" 
                               accept=".jpg,.jpeg,.png,.pdf"
                               required>
                    </div>

                    <!-- Carte d'identité verso -->
                    <div class="fr-upload-group fr-mb-3v" id="upload-carte-identite-verso-group">
                        <label class="fr-label" for="carte_identite_verso">
                            Carte d'identité (verso) <span class="fr-text--red">*</span>
                            <span class="fr-hint-text">Format accepté : JPG, PNG, PDF - Taille max : 5Mo</span>
                        </label>
                        <div class="uploaded-file-info" style="display:none; margin-bottom: 0.5rem;">
                            <span class="fr-icon-check-circle-fill fr-icon--sm" style="color: green;" aria-hidden="true"></span>
                            <a href="#" class="file-name file-preview-link" style="text-decoration: underline; margin: 0 0.5rem;"></a>
                            <button type="button" class="fr-btn fr-btn--tertiary-no-outline fr-btn--sm change-file-btn">Changer</button>
                        </div>
                        <input class="fr-upload" 
                               type="file" 
                               id="carte_identite_verso" 
                               name="carte_identite_verso" 
                               accept=".jpg,.jpeg,.png,.pdf"
                               required>
                    </div>

                    <!-- Justificatif de domicile -->
                    <div class="fr-upload-group fr-mb-3v" id="upload-justificatif-domicile-group">
                        <label class="fr-label" for="justificatif_domicile">
                            Justificatif de domicile <span class="fr-text--red">*</span>
                            <span class="fr-hint-text">Facture d'électricité, eau, gaz ou téléphone de moins de 3 mois - Format : JPG, PNG, PDF - Taille max : 5Mo</span>
                        </label>
                        <div class="uploaded-file-info" style="display:none; margin-bottom: 0.5rem;">
                            <span class="fr-icon-check-circle-fill fr-icon--sm" style="color: green;" aria-hidden="true"></span>
                            <a href="#" class="file-name file-preview-link" style="text-decoration: underline; margin: 0 0.5rem;"></a>
                            <button type="button" class="fr-btn fr-btn--tertiary-no-outline fr-btn--sm change-file-btn">Changer</button>
                        </div>
                        <input class="fr-upload" 
                               type="file" 
                               id="justificatif_domicile" 
                               name="justificatif_domicile" 
                               accept=".jpg,.jpeg,.png,.pdf"
                               required>
                    </div>

                    <!-- Relevés de notes -->
                    <div class="fr-upload-group fr-mb-3v" id="upload-releves-notes-group">
                        <label class="fr-label" for="releves_notes">
                            Relevés de notes <span class="fr-text--red">*</span>
                            <span class="fr-hint-text">Bulletins scolaires des 2 dernières années - Format : JPG, PNG, PDF - Taille max : 10Mo</span>
                        </label>
                        <div class="uploaded-file-info" style="display:none; margin-bottom: 0.5rem;">
                            <span class="fr-icon-check-circle-fill fr-icon--sm" style="color: green;" aria-hidden="true"></span>
                            <a href="#" class="file-name file-preview-link" style="text-decoration: underline; margin: 0 0.5rem;"></a>
                            <button type="button" class="fr-btn fr-btn--tertiary-no-outline fr-btn--sm change-file-btn">Changer</button>
                        </div>
                        <input class="fr-upload" 
                               type="file" 
                               id="releves_notes" 
                               name="releves_notes" 
                               accept=".jpg,.jpeg,.png,.pdf"
                               required>
                    </div>

                    <div class="fr-alert fr-alert--info fr-mt-4v">
                        <p class="fr-text--sm">
                            <strong>Important :</strong> Assurez-vous que vos documents sont lisibles et que toutes les informations sont visibles.
                            Les fichiers doivent être au format JPG, PNG ou PDF uniquement.
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Étape 6 : Validation du dossier -->
        <div class="form-step" id="step-6" style="display: none;">
            <div class="fr-card">
                <div class="fr-card__body">
                    <h2 class="fr-h2 fr-mb-3v">Validation du dossier</h2>

                    <div class="fr-checkbox-group">
                        <input type="checkbox" id="certif_exact" name="certif_exact" required>
                        <label class="fr-label" for="certif_exact">
                            Je certifie que les informations fournies sont exactes <span class="fr-text--red">*</span>
                        </label>
                    </div>

                    <div class="fr-checkbox-group">
                        <input type="checkbox" id="signature_resp" name="signature_resp" required>
                        <label class="fr-label" for="signature_resp">
                            En validant ce formulaire, je confirme avoir l'autorisation du responsable légal <span class="fr-text--red">*</span>
                        </label>
                    </div>

                    <div class="fr-alert fr-alert--info fr-mt-3v">
                        <p class="fr-text--sm">
                            <strong>Note :</strong> Une fois votre dossier soumis, vous recevrez un email de confirmation.
                            Votre dossier sera examiné par nos services et vous serez informé de la suite.
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Boutons de navigation -->
        <div class="fr-btns-group fr-btns-group--inline-md fr-mt-4v">
            <button class="fr-btn fr-btn--secondary" type="button" id="btn-previous" style="display: none;">
                Étape précédente
            </button>
            <button class="fr-btn fr-btn--secondary" type="button" id="btn-save">
                <span class="fr-icon-save-line fr-icon--sm" aria-hidden="true"></span>
                Sauvegarder et continuer plus tard
            </button>
            <button class="fr-btn" type="button" id="btn-next">
                Étape suivante
            </button>
            <button class="fr-btn" type="submit" id="btn-submit" style="display: none;">
                Soumettre mon dossier d'inscription
            </button>
        </div>
    </form>
</section>

{# Modal pour l'aperçu des documents #}
<dialog id="modal-document-preview" class="fr-modal" role="dialog" aria-labelledby="modal-preview-title" style="z-index: 10000; border: none; padding: 2rem; max-width: 90vw; max-height: 90vh; background: white; border-radius: 8px; box-shadow: 0 8px 24px rgba(0,0,0,0.3);">
    <div style="width: 100%;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; border-bottom: 2px solid #e5e5e5; padding-bottom: 1rem;">
            <h1 id="modal-preview-title" style="margin: 0; font-size: 1.5rem; color: #161616;">
                Aperçu du document
            </h1>
            <button class="fr-btn fr-btn--close" aria-controls="modal-document-preview" title="Fermer" style="cursor: pointer;">
                Fermer
            </button>
        </div>
        <div id="preview-content" style="text-align: center; min-height: 400px; width: 100%;">
            <!-- Le contenu sera inséré ici par JavaScript -->
        </div>
    </div>
</dialog>

<input type="hidden" id="specialisation-id" value="{{ specialisation.id }}">
<input type="hidden" id="user-id" value="{{ app.user.id }}">

{# Stocker les données JSON dans un script type="application/json" pour éviter les problèmes d'échappement #}
<script type="application/json" id="saved-data-json">
{{ savedData|default('{}')|raw }}
</script>

<script>
    // Debug: afficher ce que le backend envoie
    console.log('=== DONNÉES ENVOYÉES PAR LE BACKEND ===');
    console.log('specialisation-id:', {{ specialisation.id }});
    console.log('user-id:', {{ app.user.id }});
    
    // Récupérer savedData depuis le script JSON
    const savedDataElement = document.getElementById('saved-data-json');
    if (savedDataElement) {
        console.log('savedData brut:', savedDataElement.textContent);
        try {
            const parsedData = JSON.parse(savedDataElement.textContent);
            console.log('savedData parsé:', parsedData);
        } catch (e) {
            console.error('Erreur de parsing savedData:', e);
        }
    }
</script>

<script src="/js/formulaire-inscription.js?v={{ random() }}"></script>
{% endblock %}
